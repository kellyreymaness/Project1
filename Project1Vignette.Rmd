---
title: "Project 1 Vignette: Reading In and Exploring Data via an API"
author: "Kelly Baker"
date: "9/10/2020"
output: 
  rmarkdown::github_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(DT)
```

# Introduction
<br>
This vignette will walk you through how to connect with data through an API. Specifically, we will look at how to access certain endpoints (tables) as well as how join returned datasets, create new variables, and explore the data.
<br>

## Required Packages
<br>
To get started, we'll need to ensure we have the tools installed and loaded into RStudio to read in, manipulate, summarize, and plot the data. Below is an outline of packages that are required to for this project:
<br>

* **dplyr**: for data manipulation
* **DT**: for creating interactive data tables. 
* **ggplot2**: for plotting and graphing
* **readr**: for reading in data
* **tibble**: for creating special data frames with improved printing properties
* **tidyr**: for reshaping data
* **jsonlite**: for parsing API data
* **httr**: for streaming data from an API
* **knitr**: for creating tables with nic printing properties
<br>

We'll read in the packages using the library() function:
```{r packages, echo=TRUE}
library(dplyr)
library(DT)
library(ggplot2)
library(readr)
library(tibble)
library(tidyr)
library(jsonlite)
library(httr)
library(knitr)
```
<br>

# API Function Calls

<br>

## Return `franchise` data set
```{r fun1, echo=TRUE, message=FALSE, warning=FALSE, error=TRUE}
fetchFran <- function(tab) {
  URL <- "https://records.nhl.com/site/api/franchise"
  franGET <- GET(URL)
  franGET_text <- content(franGET, "text")
  franGET_json <- fromJSON(franGET_text, flatten=TRUE)
  franGET_df <- as.data.frame(franGET_json)
  invisible(franGET_df)
  return(franGET_df)
}

fetchFran()
```

## Return `franchise` data by Team Name
```{r fun2, echo=TRUE, message=FALSE, warning=FALSE, error=TRUE}
fetchFranName <- function(tab, name) {
  URL <- "https://records.nhl.com/site/api/franchise"
  franGET <- GET(URL)
  franGET_text <- content(franGET, "text")
  franGET_json <- fromJSON(franGET_text, flatten=TRUE)
  franGET_df <- as.data.frame(franGET_json)
  invisible(franGET_df)
  return(franGET_df %>% filter(data.teamCommonName==name))
}

fetchFranName(name="Tigers")
```

## Return `franchise` data by Team ID
```{r fun3, echo=TRUE, message=FALSE, warning=FALSE, error=TRUE}
fetchFranID <- function(tab, id) {
  URL <- "https://records.nhl.com/site/api/franchise"
  franGET <- GET(URL)
  franGET_text <- content(franGET, "text")
  franGET_json <- fromJSON(franGET_text, flatten=TRUE)
  franGET_df <- as.data.frame(franGET_json)
  invisible(franGET_df)
  return(franGET_df %>% filter(data.id==id))
}

fetchFranID(id=1)
```

## Return `franchise team totals` dataset
```{r fun4}
fetchFranTotal <- function(tab, ...) {
  URL <- "https://records.nhl.com/site/api/franchise-team-totals"
  franGET <- GET(URL)
  franGET_text <- content(franGET, "text")
  franGET_json <- fromJSON(franGET_text, flatten=TRUE)
  franGET_df <- as.data.frame(franGET_json)
  invisible(franGET_df)
  return(franGET_df)
}

head(fetchFranTotal(n))
```

## Return `franchise team totals` by Team Name
```{r fun5}
fetchFranNameTotal <- function(tab, name) {
  URL <- "https://records.nhl.com/site/api/franchise-team-totals"
  franGET <- GET(URL)
  franGET_text <- content(franGET, "text")
  franGET_json <- fromJSON(franGET_text, flatten=TRUE)
  franGET_df <- as.data.frame(franGET_json)
  invisible(franGET_df)
  return(franGET_df %>% filter(data.teamName==name))
}

fetchFranNameTotal(name="Boston Bruins")
```

## Return `franchise team totals` by Franchise ID
```{r fun6}
fetchFranIDTotal <- function(tab, franID) {
  URL <- "https://records.nhl.com/site/api/franchise-team-totals"
  franGET <- GET(URL)
  franGET_text <- content(franGET, "text")
  franGET_json <- fromJSON(franGET_text, flatten=TRUE)
  franGET_df <- as.data.frame(franGET_json)
  invisible(franGET_df)
  return(franGET_df %>% filter(data.franchiseId==franID))
}

fetchFranIDTotal(franID=8)
```


## Return `franchise season records` by Franchise ID
```{r fun7, echo=TRUE}
fetchSeasonRecords <- function(ID, ...) {
  URL <- "https://records.nhl.com/site/api/franchise-season-records?cayenneExp=franchiseId="
  ID <- ID
  fullURL <- paste0(URL,ID)
  franGET <- GET(fullURL)
  franGET_text <- content(franGET, "text")
  franGET_json <- fromJSON(franGET_text, flatten=TRUE)
  return(franGET_json)
}

fetchSeasonRecords(ID=6)
```

## Return `goalie records` by Franchise ID
```{r fun8}
fetchGoalieRecords <- function(ID, ...) { 
  URL <- "https://records.nhl.com/site/api/franchise-goalie-records?cayenneExp=franchiseId="
  ID <- ID
  fullURL <- paste0(URL,ID)
  franGET <- GET(fullURL)
  franGET_text <- content(franGET, "text")
  franGET_json <- fromJSON(franGET_text, flatten=TRUE)
  return(franGET_json)
}

fetchGoalieRecords(ID=12)
```

## Return `skater records` by Franchise ID
```{r fun9}
fetchSkaterRecords <- function(ID, ...) {
  URL <- "https://records.nhl.com/site/api/franchise-skater-records?cayenneExp=franchiseId="
  ID <- ID
  fullURL <- paste0(URL,ID)
  franGET <- GET(fullURL)
  franGET_text <- content(franGET, "text")
  franGET_json <- fromJSON(franGET_text, flatten=TRUE)
  return(franGET_json)
}

fetchSkaterRecords(ID=9)
```


## Return `team stats` data
```{r fun10}

```
<br>
## Wrapper function
<br>

# Data Manipulation
<br>
```{r}

str(fetchSkaterRecords(ID=1))
```



## Joins
<br>


## Creating New Variables
<br>

# Nummeric Summarization

## 5 Number Summary
<br>
We'll do some basic numeric summarization using data from one of hockey's most storied franchises, the Montreal Canadiens. Let's pull in Skater Records using our fetchSkaterRecords() function, setting ID=1, to get started. Because this data is in list form, we will convert it to a data frame. Next, let provide a basic five number summary of assists and goals by skater position. Because we'll need to generate tables to four positions (R - right wing; C - center; L - left wing; D -), we'll create a function called summByPosition() to help automate this process. 
```{r numsumm, echo=TRUE}
canadiensSkaterRec <- fetchSkaterRecords(ID=1)
canSkateRec <- as.data.frame(canadiensSkaterRec)

summByPosition <- function(position) {
  data <- canSkateRec %>% filter(data.positionCode==position) %>% select(data.assists, data.goals)
  kable(apply(data, 2, summary), col.names=c("Assists", "Goals"), caption = paste0("Historical Summary of Assists & Goals Scored by Position=", position, " for the Montreal Canadiens"))
}

summByPosition("R")
summByPosition("C")
summByPosition("L")
summByPosition("D")
```
The tables generated above reveal that right wing(R), left wing(L) and centers(C) score, on average, higher than defensemen (D). This aligns with what I would've expected given the fact that offensive positions are tasked with being a team's primary scorers, while defensive positions are not. I was somewhat surprised to see that, though defense trails offense in assists on average, that it wasn't by much when comparing left wingers to defensemen.

## Contingency Tables

<br>
#Graphing

